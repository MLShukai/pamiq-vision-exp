# CLAUDE.md

このファイルはClaude Codeがこのリポジトリを扱う際のガイダンスを提供する。

## コマンド

- `make setup` - 開発環境のセットアップ
- `make test` - Slow以外のテストを実行
- `make test-slow` - 全テストを実行
- `make format` - フォーマッタを実行
- `make type` - 型チェックを実行

## テスト方針

### 基本原則

- 必要十分なテストのみを記述する。過剰なテストは避ける
- 内部実装の詳細はテストしない。公開インターフェースと振る舞いをテストする
- テスト関数に戻り値の型アノテーションは不要

### ハードウェアテストとモックテスト

- 同一のテストクラス内で、ハードウェアテストとモックテストを分離する
- Slowテストには `@mark_slow` デコレータを付与する
- 複数のパラメータをテストする場合は `@pytest.mark.parametrize` を使用する

### モック

- `pytest_mock` を使用する
- 複数のテストで共有するモックは `tests/conftest.py` にフィクスチャとして定義する
- 特定のテストでのみモックの振る舞いを変更する場合、フィクスチャの戻り値を使って設定を上書きする

### 何をテストするか

- 正常系: 期待通りの入力に対する出力
- 異常系: エラー発生時の例外やメッセージ
- 警告: 設定失敗時などのRuntimeWarning
- エッジケース: 境界値やサイズ違いの入力

### 何をテストしないか

- 内部実装の詳細（例: 特定のメソッドが呼ばれたか）
- 初期化時のプロパティ設定などの内部動作

## コーディング規約

### カプセル化

- クラスの内部実装の詳細や属性は、基本的にすべて private（`_` prefix）にする
- 外部から参照する必要がある属性のみ public にする
- `__init__` で設定される属性は原則として private とする

例:

```python
class Example:
    def __init__(self, dim: int):
        self._dim = dim  # private
        self._layer = nn.Linear(dim, dim)  # private
```
